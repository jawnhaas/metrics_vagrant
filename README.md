## Info ##
This is a sample Vagrant configuration which provisions a server instance with PHP, Apache and MySQL using Chef. It configures the server instance by creating a vhost, provisioning a database, setting permissions, and then importing a sample sql file with random person data generated by [Mockaroo](http://www.mockaroo.com/). The php output is a simple html table with first and last names.

## Project ##
All files referenced are documented throughout, below is an overview of each file touched. To make the project easy to run, all the dependancies from [Chef Supermarket](https://community.opscode.com/cookbooks) are included. 

#### Vagrantfile ####
[Vagrantfile](https://github.com/jawnhaas/metrics_vagrant/blob/master/Vagrantfile)
sets some configuration values in the chef.json section, sets document paths and base VM configuration.

[Vagrantfile.chef](https://github.com/jawnhaas/metrics_vagrant/blob/master/Vagrantfile.chef)
changes the ssl_verify_mode to :verify_peer from the default :verify_none to get rid fo the warnings during provisioning

#### Roles ####
[app_server.rb](https://github.com/jawnhaas/metrics_vagrant/blob/master/roles/app_server.rb)
this is a role that setups up a basic app server which runs apache, mysql and PHP.

[example.rb](https://github.com/jawnhaas/metrics_vagrant/blob/master/roles/example.rb)
this is a role that extends the app-server role and runs the rjmetrics recipe to demonstrate extending other roles.

#### RjMetrics Cookbook ####
[metadata.rb](https://github.com/jawnhaas/metrics_vagrant/blob/master/my_cookbooks/rjmetrics/metadata.rb)
is an overview of the cookbook and a list of the dependancies required for it to run. 

[default.rb](https://github.com/jawnhaas/metrics_vagrant/blob/master/my_cookbooks/rjmetrics/recipes/default.rb)
this recipe creates the connection string, database, sets permissions, and imports a SQL file for data. **The SQL import is done for for the sake of the demo, so it runs without additional configuration. Normally i would not include data imports in a configuration management system.

[site.conf.erb](https://github.com/jawnhaas/metrics_vagrant/blob/master/my_cookbooks/rjmetrics/templates/default/site.conf.erb)
is a ruby erb template used to setup the vhost document root set in the chef.json portion of the Vagrantfile.

## Requirements ##
- Virtual Box
- Vagrant ~1.1

## Setup ##
1. Go into metrics_vagrant/Vagrantfile and add a password to the line under the chef.json configuration change  `"mysql" => {"server_root_password" => ""}` to include a password. E.g. `"mysql" => {"server_root_password" => "asdf"}` 
2. Clone the metrics_vagrant repository `git clone https://github.com/jawnhaas/metrics_vagrant.git` and make that your working directory `cd metrics_vagrant`
3. Install the vagrant-omnibus plugin `vagrant plugin install vagrant-omnibus` to ensure the desired version of Chef is installed via the platform-specific Omnibus packages.
4. Run `vagrant up`
5. Go into metrics_vagrant/webroot/index.php and add the password from step 1. to `$con = mysqli_connect('localhost', 'root', '', 'rjmetrics');` E.g. `$con = mysqli_connect('localhost', 'root', 'asdf', 'rjmetrics');`
6. Open up [http://localhost:8080](http://localhost:8080) in a browser.
